# 리피터 허브

-   트위스트 페어케이블
    - 잡음에 의해 신호가 약해지는것을 방지한다.
   
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fd677PI%2FbtrAyNZdItc%2F8UUysdpK6dasentCNtRBX1%2Fimg.png)


<br> 

- 연결되어 있는 전체 케이블에 신호를 송신한다.
  - 수신처 MAC 주소에 해당하는 기기만 패킷을 수신
 
 <br>
 
### 리피터 회로

- 리피터 허브에서 PHY(MAU) 회로의 수신부에 도달한 신호는 **리피터 회로**에 들어간다.
- 들어온 신호는 그대로 커넥터 부분에 송출한다. 
- 신호는 모든 커넥터에서 나가면서 리피터 허브에 접속한 전체 기기에 도달한다.
- 신호를 수신한 기기는 맨 앞에 있는 MAC 헤더에 쓰여있는 수신처 MAC 주소를 조사하여 자신이 수신처에 해당하면 이것을 수신하고, 해당하지 않으면 무시한다.
- 신호를 그대로 뿌리므로 잡음의 영향을 받아 변형되고, 데이터가 변화한 신호라도 그대로 흘린다.
- FCS(Frame Check Sequence) 검사에서 데이터 변화가 판명된 후 변화된 패킷은 폐기한다.

<br>

# 스위칭 허브

- 스위칭 허브의 PHY(MAU) 수신 회로로 들어오면 FCS를 대조하여 오류의 유무를 검사 후 문제가 없으면 버퍼 메모리에 저장한다.
- 스위칭 허브의 포트는 수신처 MAC 주소를 검사하지 않고 모든 패킷을 수신하여 버퍼 메모리에 저장한다.
 - LAN 어댑터와 달리 MAC 주소가 할당되어 있지 않다.

버퍼메모리에 저장한 후 수신처 MAC 주소와 일치하는 것이 MAC 주소표에 등록되어 있는지 조사한다.
<br>

수신한 패킷을 어느 포트에서 송신하면 좋을지 판단 후 송신쪽 포트에 패킷을 운반하면 MAC회로 또는 PHY(MAU)회로가 송신 동작을 실행하고 케이블에 신호가 흘러간다.
<br>

### MAC 주소 테이블을 등록 및 갱신한다.

- 패킷을 수신했을때 송신처 MAC 주소를 조사하고, 이것을 수신한 입력 포트 번호와 하나의 세트로 MAC 주소표에 등록한다.
- 이러한 등록 동작을 실행한 후 한 번이라도 패킷을 송신하면 해당 기기의 MAC 주소가 MAC 주소표에 등록된다.
- 일정시간이 경과하면 삭제한다. (보통 몇 분)
 - 기존에 등록되어 있는 MAC 주소표에 존재하는 MAC 주소에 패킷을 보내려 한다면 제대로 통신이 되지 않는다.
 
<br>

### 예외적인 동작

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FHwkSh%2FbtrAz8obRec%2FgaH207cqSKX2tBu9ktX0C1%2Fimg.png)

- 수신한 포트와 송신하는 포트가 같을 경우 패킷을 중계하지 않고 폐기한다.

예를들어 PC A에서 보낸 패킷이 리피터 허브에서 모든 포트에 뿌려져 스위칭 퍼브와 PC B에 도착할 경우

스위칭 허브가 리피터 허브에 반송하면 리피터 허브에서 다시 뿌려지고 

PC B 에 두 개의 같은 패킷이 도착한다.

<br>

### 전이중 모드에서 송신과 수신을 동시에 실행한다.

**전이중 모드** 송신과 수신을 동시에 실행할 수 있는 성질도 리피터 허브에 없는 스위칭 허브의 특징

MAU 송신 부분과 수신 부분 사이에는 신호 충돌을 조사하는 부분이 있다.

전이중 동작의 경우 이 역할을 무효로 만든다.

트위스트 페어 케이블의 신호선은 송신용과 수신용으로 나누어져 있다. 충돌하지 않음.

이더넷은 데이터가 흐르고 있지 않을 때는 **링크 펄스**라는 펄스형의 신호를 흘린다.케이블의 상태를 확인

펄스 신호를 이용해 상대가 어떤 모드를 지원하는지 조사한다.

<br>

# 라우터의 패킷 중계 동작

중계 부분과 포트 부분으로 나누어져 있다.

- 중계 부분
    - 패킷의 중계 대상을 판단하는 동작을 담당
- 포트 부분
    - 패킷을 송/수신하는 동작을 담당

포트 부분의 통신 기술의 규칙을 따라 패킷을 송/수신한다.

<br>

라우터의 각 포트에는 MAC 주소와 IP 주소가 할당되어 있다.
<br>

라우터는 IP 주소로 중계 대상을 판단한다.
<br>

라우팅 테이블 (경로표)IP주소와 수신한 패킷의 수신처 IP 주소를 비교하여 그행이 해당하는지 판단한다.
스위칭 허브처럼 두 가지 모두 완전히 일치하는지 조사하는 것이 아니라 호스트 번호 부분을 무시하고 **네트워크 번호** 부분만 조사한다.
주소 비교 동작을 실행할 때 네트워크 번호의 비트 수를 판단해야 하므로 경로표에는 넷마스크 항목도 마련되어 있다.

<br>

라우터의 경로표에 경로 정보를 등록하는 방법

- 사람이 수동으로 경로 정보를 등록/갱신
- 라우팅 프로토콜이라는 구조를 사용하여 라우터들끼리 경로 정보를 교환하고 라우터가 자체에서 경로표를 등록

<br>

### 경로표를 검색하여 출력 포트를 발견한다

라우터는 패킷 수신 동작이 끝나면 맨 앞의 MAC 헤더를 폐기한다.

MAC 헤더의 역할은 해당 라우터에 패킷을 건네주는 것

MAC 헤더의 수신처 MAC 주소 항목에 라우터의 포트에 할당한 MAC 주소가 기록되어 있다.

<br>

### 해당하는 경로가 없는 경우에 선택하는 기본 경로

넷마스크 0.0.0.0이라는 것은 패킷의 수신처 IP 주소와 경로표의 ‘수신처' 항목을 비교할 때의 비트 수가 0이라는 것이므로 비교동작을 실행하지 않아도 된다.

(비교하는 비트 수가 긴 것을 우선하는 개념이 있다) 따라서 0.0.0.0인 행은 우선순위가 가장 낮아진다.

기본경로, 기본 게이트웨이
<br>

### 패킷은 유효 기한이 있다

경로표에서 중계 대상을 찾으면 패킷을  출력측의 포트로 옮기고 송신하는데, TTL(TIme To Live 생존 기간)이라는 IP헤더의 필드를 갱신한다.

패킷이 같은 장소를 순환하는 사태를 막기 위해 TTL은 라우터를 경유할 때 마다 값을 1씩 줄이다가 0이 되면 폐기한다.

<br>

### 큰 패킷은 조각 나누기 기능으로 분할한다

중계하는 패킷의 크기가 출력측의 패킷 최대 길이를 초과하면 그대로 패킷을 송신할 수 없다.

이 경우 IP 프로토콜에 규정된 조각 나누기(fragmentation)이라는 방법을 사용하여 패킷을 분할하고 패킷의 길이를 짧게 만든 후 중계한다.

<br>

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcsSxJf%2FbtrAzu6cuyb%2FQNvq035FDaiGPoy7w6jHvk%2Fimg.jpg)

<br>

1. 출력측의 MTU를 조사하여 중계하는 패킷을 그대로 출력측에서 송신할 수 있는지 조사한다.
2. 출력측의 MTU가 작을 경우 저장할 수 있는 크기로 패킷을 분할한다.
3. IP 헤더의 플래크 필드를 조사하여 분할해도 좋을지 확인한다. → 플래그필드가 분할 불가로 되어있느면 분할하지 않고 패킷을 폐기하고 ICMP 메시지로 송신처에 통보한다.
4. TCP 헤더 이후 부분을 분할 대상 데이터로 간주하고 분할한다.
5. 데이터 분할 후 IP헤더를 덧붙인다. → 예를들어 TCP 헤더가 없고 데이터만 있을경우 IP 헤더를 덧 붙인다. (원래 패킷의 IP헤더를 그대로 복사)

분할한 핵심 정보를 IP헤더에 기록하기 위해 일부 필드는 고쳐쓴다. 

<br>

### 라우터의 송신동작은 컴퓨터와 같다

MAC 헤더의 맨앞에 있는 수신처 MAC 주소 필드에 값을 설정하기 위해 경로표의 ‘게이트웨이' 항목에서 패킷을 건네줄 상대를 판단한다.
‘게이트웨이 ‘ 항목에 IP 주소가 쓰여있으면 해당 IP가 건네줄 상대이고, 비어있으면 IP헤더의 수신처가 건네줄 상대가 된다.
IP 주소가 결정되면 ARP로 IP 주소에서 MAC 주소를 조사하고, 결과를 수신처 MAC 주소로 설정한다.

<br>

라우터에도 ARP 캐시가 있어 ARP 캐시를 먼저 확인 후 없을 경우 APR로 조회를 보내 MACC 주소를 조회한다.

<br>

### 라우터와 스위칭 허브의 관계

IP라는 구조는 스스로 패킷을 운반하는 수단이 없으므로 패킷을 운반할 때는 이더넷에 의뢰하여 운반한다.

라우터는 IP의 개념에 기초하여 만들어졌고, 스위칭 허브는 이더넷에 기초하여 만들어졌다.

라우터는 패킷을 운반하는 일을 스위칭 허브에 의뢰한다.

통신 상대까지 패킷을 전할하는 전체의 동작은 IP(라우터)가 담당하고, 이더넷(스위칭 허브)가 다음 라우터까지 패킷을 운반한다.

<br>

### 주소 변환으로 IP 주소를 효율적으로 이용한다

사내 기기에 할당하는 주소는 다른 회사와 증복되어도 좋고, 사내에서도 특정 주소를 사내용으로 한다는 규칙을 세웠다.

- 사내용 주소 
  - 프라이비트 주소(private address)

- 고유한 주소
  - 글로벌 주소(global address)

10.0.0.0 ~ 10.255.255.255

172.16.0.0 ~ 172.31.255.255

192.168.0.0 ~ 192.168.255.255

<br>

### 주소변환의 기본 동작

<br>

[##_Image|kage@ZPOXS/btrAAZLqrBq/rBEvOiI2nNF4G0kCMLTop1/img.jpg|alignCenter|width="100%"|_##]

<br>

주소 변환 장치 내부에 있는 대응표에 글로벌 주소와 프라이비트 주소를 기록해 둔다.

<br>

주소 변환의 구조는 패킷을 중계할 때 IP 헤더에 기재된 IP주소와 포트 번호를 바꿔서 패킷을 사내용 주소로 변경한다.

<br>

### 포트 번호를 바꿔쓰는 이유

글로벌 주소와 포트번호를 프라이빗 주소랑 1:1로 매응할 경우 인터넷에 접속하는 대수만큼 글로벌 주소가 필요하다.